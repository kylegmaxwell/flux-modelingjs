{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "types": {
        "brep_format": { "enum": [ "x_b", "x_t", "iges", "step", "sat", "sab", "stl" ] },

        "index": {
            "type":    "integer",
            "minimum": 0
        },
        "indexNonzero": {
            "type":    "integer",
            "minimum": 0,
            "exclusiveMinimum": true
        },
        "direction": {
            "type": "array",
            "items": { "type": "number" },
            "minItems": 3,
            "maxItems": 3
        },
        "unitNumber": {
            "type":    "number",
            "minimum": 0,
            "maximum": 1
        },
        "fluxid": {
            "type": "string"
        },
        "angle": {
            "type": "number",
            "fluxDimension": "angle"
        },
        "coordinate": {
            "type": "number",
            "fluxDimension": "length"
        },
        "distance": {
            "type":     "number",
            "minimum":  0,
            "fluxDimension": "length"
        },
        "area": {
            "type": "number",
            "minimum": 0,
            "fluxDimension": "area"
        },
        "volume": {
            "type": "number",
            "minimum": 0,
            "fluxDimension": "volume"
        },
        "distanceNonzero": {
            "type":     "number",
            "minimum":  0,
            "exclusiveMinimum": true,
            "fluxDimension": "length"
        },
        "position": {
            "type": "array",
            "items": { "$ref": "#/types/coordinate" },
            "minItems": 3,
            "maxItems": 3
        },
        "dimensions": {
            "type": "array",
            "items": { "$ref": "#/types/distanceNonzero" },
            "minItems": 3,
            "maxItems": 3
        },
        "units": {
            "type": "object",
            "additionalProperties": false,
            "patternProperties": {
                ".*" : {"type": "string" }
            }
        },
        "boundingBox":{
            "type": "array",
            "items":{ "$ref": "#/types/position" },
            "minItems": 2,
            "maxItems": 2
        },
        "matrix":{
            "type": "array",
            "items": { "type": "number" },
            "minItems": 16,
            "maxItems": 16
        },
        "color":{
            "type": "array",
            "items": {"type": "number"},
            "minItems": 3,
            "maxItems": 3
        }
    },
    "entities": {
        "empty": { "type": "object", "additionalProperties": false },
        "number": { "type": "number" },

        "brep": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "brep" ] },
                "content":      { "type": "string"   },
                "format":       { "$ref": "#/types/brep_format" },
                "isCompressed": { "type": "boolean" },
                "isBase64":     { "type": "boolean" },
                "vertices":     {
                    "type":     "array",
                    "items":    { "$ref": "#/types/position" }
                },
                "faces":        {
                    "type":     "array",
                    "items":    {
                        "type":     "array",
                        "items":    { "$ref": "#/types/index" },
                        "minItems": 3
                    }
                },
                "attributes":   { "type":  "object" }
            },
            "required": [ "primitive", "content", "format" ]
        },

        "vector": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "vector" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "coords":       { "$ref": "#/types/position" }
            },
            "required": [ "primitive", "coords" ]
        },
        "point": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "point" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "point":       { "$ref": "#/types/position" }
            },
            "required": [ "primitive", "point" ]
        },

        "plane": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "plane" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "origin":       { "$ref": "#/types/position"  },
                "normal":       { "$ref": "#/types/direction" }
            },
            "required": [ "primitive", "origin", "normal" ]
        },
        "affineTransform": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "affineTransform" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "mat":          {
                    "type": "array",
                    "items": { "type": "number" },
                    "minItems": 16,
                    "maxItems": 16,
                    "fluxDimension": "affineMatrix"
                }
            },
            "required": [ "primitive", "mat" ],
            "additionalProperties": false
        },
        "massProps": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "massProps" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "mass":         { "$ref": "#/types/distance" },
                "centerOfMass": { "$ref": "#/types/position" },
                "inertiaTensor":{
                    "type": "array",
                    "items": { "$ref": "#/types/direction" },
                    "minItems": 3,
                    "maxItems": 3
                },

                "volume":       { "$ref": "#/types/volume"   },
                "surfaceArea":  { "$ref": "#/types/area"     },
                "length":       { "$ref": "#/types/distance" },
                "circumference":{ "$ref": "#/types/distance" }
            },
            "required": [ "primitive", "mass", "centerOfMass", "inertiaTensor" ],
            "additionalProperties": false
        },

        "line": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "line" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "start":        { "$ref": "#/types/position" },
                "end":          { "$ref": "#/types/position" }
            },
            "required": [ "primitive", "start", "end" ]
        },
        "polyline": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "polyline" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "points":       {
                    "type": "array",
                    "items": { "$ref": "#/types/position" },
                    "minItems": 2
                }
            },
            "required": [ "primitive", "points" ]
        },
        "circle": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "circle" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "origin":       { "$ref": "#/types/position" },
                "radius":       { "$ref": "#/types/distanceNonzero" },
                "axis":         { "$ref": "#/types/direction" }
            },
            "required": [ "primitive", "origin", "radius" ]
        },
        "ellipse": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "ellipse" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "origin":       { "$ref": "#/types/position" },
                "majorRadius":  { "$ref": "#/types/distanceNonzero" },
                "minorRadius":  { "$ref": "#/types/distanceNonzero" },
                "axis":         { "$ref": "#/types/direction" },
                "reference":    { "$ref": "#/types/direction" }
            },
            "required": [ "primitive", "origin", "majorRadius", "minorRadius" ]
        },
        "curve": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "curve" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "degree":       { "$ref": "#/types/indexNonzero" },
                "controlPoints":{ "type": "array", "items": { "$ref": "#/types/position" }},
                "knots":        { "type": "array", "items": { "type": "number" }},
                "weights":      { "type": "array", "items": { "type": "number" }}
            },
            "required": [ "primitive", "degree", "controlPoints", "knots" ]
        },
        "arc": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "arc" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "start":        { "$ref": "#/types/position" },
                "middle":       { "$ref": "#/types/position" },
                "end":          { "$ref": "#/types/position" }
            },
            "required": [ "primitive", "start", "middle", "end" ]
        },
        "rectangle": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "rectangle" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "origin":       { "$ref": "#/types/position" },
                "dimensions":   {
                    "type": "array",
                    "items": { "$ref": "#/types/distanceNonzero" },
                    "minItems": 2,
                    "maxItems": 2,
                    "additionalItems": false
                },
                "axis":         { "$ref": "#/types/direction" },
                "reference":    { "$ref": "#/types/direction" }
            },
            "required": [ "primitive", "origin", "dimensions" ]
        },
        "polycurve": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "polycurve" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "curves":       {
                    "type":  "array",
                    "minItems": 1,
                    "items": { "oneOf": [
                        { "$ref": "#/entities/line" },
                        { "$ref": "#/entities/polyline" },
                        { "$ref": "#/entities/curve" },
                        { "$ref": "#/entities/arc" }
                    ] }
                }
            },
            "required": [ "primitive", "curves" ]
        },

        "surface": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "surface" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "uDegree":      { "$ref": "#/types/indexNonzero" },
                "vDegree":      { "$ref": "#/types/indexNonzero" },
                "uKnots":       { "type": "array", "items": { "type": "number" }},
                "vKnots":       { "type": "array", "items": { "type": "number" }},
                "controlPoints":{
                    "type": "array",
                    "items": {
                        "type": "array",
                        "items": {
                            "$ref": "#/types/position"
                        }
                    }
                },
                "weights":      { "type": "array", "items": { "type": "number" }}
            },
            "required": [ "primitive", "uDegree", "vDegree", "uKnots", "vKnots", "controlPoints" ]
        },
        "polysurface": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "polysurface" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "surfaces": {
                    "type": "array",
                    "items": { "oneOf": [
                        { "$ref": "#/entities/surface" }
                    ]},
                    "minItems": 1
                }
            },
            "required": [ "primitive", "surfaces" ]
        },

        "block": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "block" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },
                "origin":       { "$ref": "#/types/position" },
                "dimensions":   { "$ref": "#/types/dimensions" },
                "axis":         { "$ref": "#/types/direction" },
                "reference":    { "$ref": "#/types/direction" }
            },
            "required": [ "primitive", "origin", "dimensions" ]
        },
        "torus": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "torus" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "origin":       { "$ref": "#/types/position" },
                "majorRadius":  { "$ref": "#/types/coordinate" },
                "minorRadius":  { "$ref": "#/types/distanceNonzero" },
                "axis":         { "$ref": "#/types/direction" }
            },
            "required": [ "primitive", "origin", "majorRadius", "minorRadius" ]
        },
        "sphere": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "sphere" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "origin":       { "$ref": "#/types/position" },
                "radius":       { "$ref": "#/types/distanceNonzero" }
            },
            "required": [ "primitive", "origin", "radius" ]
        },
        "cylinder": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "cylinder" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "origin":       { "$ref": "#/types/position" },
                "radius":       { "$ref": "#/types/distanceNonzero" },
                "height":       { "$ref": "#/types/distanceNonzero" },
                "axis":         { "$ref": "#/types/direction" }
            },
            "required": [ "primitive", "origin", "radius", "height" ]
        },
        "cone": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "cone" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "origin":       { "$ref": "#/types/position" },
                "radius":       { "$ref": "#/types/distanceNonzero" },
                "height":       { "$ref": "#/types/distanceNonzero" },
                "semiAngle":    { "$ref": "#/types/angle" },
                "axis":         { "$ref": "#/types/direction" }
            },
            "required": [ "primitive", "origin", "radius", "height", "semiAngle" ]
        },
        "mesh": {
            "type": "object",
            "properties": {
                "id":           { "$ref": "#/types/fluxid" },
                "primitive":    { "enum": [ "mesh" ] },
                "__repr__":     { "type": "string" },
                "attributes":   { "type":  "object" },
                "units":        { "$ref": "#/types/units" },

                "vertices":     {
                    "type":     "array",
                    "items":    { "$ref": "#/types/position" }
                },
                "faces":        {
                    "type":     "array",
                    "items":    {
                        "type":     "array",
                        "items":    { "$ref": "#/types/index" },
                        "minItems": 3
                    }
                },
                "isSolid": { "type": "boolean" }
            },
            "required": [ "primitive", "vertices", "faces" ]
        }
    },
    "scene":{
        "instance": {
                "type": "object",
                "properties": {
                    "attributes":   { "type":  "object" },
                    "primitive":    { "enum": [ "instance" ] },
                    "id":           { "$ref": "#/types/fluxid" },
                    "matrix":       { "$ref": "#/types/matrix" },
                    "bbox":         { "$ref": "#/types/boundingBox" },
                    "label":        { "type": "string" },
                    "entity":       { "$ref": "#/types/fluxid" }
                },
                    "required": [ "primitive", "id", "entity" ],
                    "additionalProperties": false
            },
        "geometryList": {
                "type": "object",
                "properties": {
                    "attributes":   { "type":  "object" },
                    "primitive":    { "enum": [ "geometryList" ] },
                    "id":           { "$ref": "#/types/fluxid" },
                    "entity": {
                        "anyOf": [
                            { "type": "array"  },
                            { "type": "object" }
                        ]
                    },
                    "required": [ "primitive", "id", "entity" ],
                    "additionalProperties": false
                }
            },
        "group": {
            "type": "object",
            "properties": {
                "attributes":   { "type":  "object" },
                "primitive":    { "enum":[ "group" ] },
                "id":           { "$ref": "#/types/fluxid" },
                "matrix":       { "$ref": "#/types/matrix" },
                "bbox":         { "$ref": "#/types/boundingBox" },
                "label":        { "type": "string" },
                "children":     {
                    "type":     "array",
                    "items":    { "$ref": "#/types/fluxid" }
                }
            },
            "required": [ "primitive", "id", "children" ],
            "additionalProperties": true
        },
        "layer": {
            "type": "object",
            "properties": {
                "attributes":   { "type":  "object" },
                "primitive":    { "enum":[ "layer" ] },
                "id":           { "$ref": "#/types/fluxid" },
                "label":        { "type": "string" },
                "color":        { "$ref": "#/types/color" },
                "visible":      { "type": "boolean" },
                "elements": {
                    "type":     "array",
                    "items":    { "$ref": "#/types/fluxid" }
                }
            },
            "required": [ "primitive", "id", "elements" ],
            "additionalProperties": false
        },
        "camera": {
            "type": "object",
            "properties": {
                "attributes":   { "type":  "object" },
                "primitive":    { "enum":[ "camera" ] },
                "id":           { "$ref": "#/types/fluxid" },
                "type":         { "enum":[ "orthographic", "perspective" ]},
                "units":        { "$ref": "#/types/units" },
                "nearClip":     { "$ref": "#/types/distance" },
                "farClip":      { "$ref": "#/types/distance" },
                "focalLength":  { "$ref": "#/types/distance" }
            },
            "required": [ "id", "primitive", "type" ],
            "additionalProperties": false
        },
        "light": {
            "type": "object",
            "properties": {
                "attributes":   { "type":  "object" },
                "primitive":    { "enum":[ "light" ] },
                "id":           { "$ref": "#/types/fluxid" },
                "type":         { "enum": [ "point", "directional", "spot" ]},
                "units":        { "$ref": "#/types/units" },
                "color":        { "$ref": "#/types/color" },
                "intensity":    { "type": "number" },
                "coneAngle":    { "$ref": "#/types/angle" }
            },
            "required": [ "id", "primitive", "type" ],
            "additionalProperties": false
        }
    }
}
